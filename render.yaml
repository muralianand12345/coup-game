services:
    - type: web
      name: coup-server
      runtime: node
      rootDir: packages/server
      buildCommand: cd ../.. && yarn install && yarn build:shared && yarn build:server
      startCommand: node dist/index.js
      healthCheckPath: /health
      envVars:
          - key: NODE_ENV
            value: production
          - key: CLIENT_URL
            sync: false

    - type: web
      name: coup-client
      runtime: static
      rootDir: packages/client
      buildCommand: cd ../.. && yarn install && yarn build:shared && cd packages/client && yarn build
      staticPublishPath: dist
      headers:
          - path: /*
            name: Cache-Control
            value: no-cache
      routes:
          - type: rewrite
            source: /*
            destination: /index.html
      envVars:
          - key: VITE_SERVER_URL
            sync: false
